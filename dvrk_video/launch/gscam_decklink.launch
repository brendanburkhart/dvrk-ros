<!-- -*- mode: XML -*- -->

<launch>
  <arg name="nodelet_manager"/>
  <arg name="camera_name" default="camera"/>
  <arg name="camera_params" default="package://dvrk_config/$(arg camera_name)_camera_parameters.yaml"/>
  <arg name="connection" default="sdi"/>
  <arg name="device" default="0"/>
  <arg name="frame_id" default="$(arg camera_name)_frame"/>

  <!-- gscam uses /<camera>/camera_info and /set_camera_info, remapping to avoid collisions when using multple cameras -->
  <remap from="set_camera_info" to="$(arg camera_name)/set_camera_info"/>

  <!-- camera driver nodelet -->
  <node pkg="nodelet" type="nodelet"
      name="$(arg camera_name)"
      args="load gscam/GSCamNodelet $(nodelet_manager)"
      output="screen">
    <param name="camera_name" value="$(arg camera_name)"/>
    <param name="camera_info_url" value="$(arg camera_params)"/>
    <param name="gscam_config" value="decklinkvideosrc connection=$(arg connection) device-number=$(arg device) ! videoconvert"/>
    <param name="frame_id" value="$(arg frame_id)"/>
    <!-- This needs to be set to false to avoid dropping tons of frames -->
    <param name="sync_sink" value="false"/>
  </node>

  <!-- color processing nodelet -->
  <node pkg="nodelet" type="nodelet"
      name="$(arg camera_name)_color"
      args="load image_proc/debayer"
      output="screen">
    <remap from="image_raw" to="$(arg camera_name)/image_raw">
    <remap from="image_mono" to="$(arg camera_name)/image_mono">
    <remap from="image_color" to="$(arg camera_name)/image_color">
  </node>

  <!-- iamge rectification nodelet -->
  <node pkg="nodelet" type="nodelet"
      name="$(arg camera_name)_rectification"
      args="load image_proc/rectify"
      output="screen">
    <remap from="camera_info" to="$(arg camera_name)/camera_info">
    <remap from="image_mono" to="$(arg camera_name)/image_color">
    <remap from="image_rect" to="$(arg camera_name)/image_rect_color">
  </node>
</launch>
